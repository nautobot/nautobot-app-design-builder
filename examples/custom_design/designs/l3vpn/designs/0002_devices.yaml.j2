---



{% macro device_edit(device, other_device, offset) -%}
  - "!update:name": "{{ device.name }}"
    local_context_data: {
      "mpls_router": true,
    }
    interfaces:
      - "!next_interface": {}
        status__name: "Planned"
        type: "other"
        {% if offset == 2 %}
        "!connect_cable":
          status__name: "Planned"
          to: "!ref:other_interface"
        {% else %}
        "!ref": "other_interface"
        {% endif %}
        tags:
          - {"!get:name": "VRF Interface"}
        ip_address_assignments:
          - ip_address:
              "!child_prefix:address":
                parent: "!ref:l3vpn_p2p_prefix"
                offset: "0.0.0.{{ offset }}/30"
              status__name: "Reserved"

{% endmacro %}

devices:
  {{ device_edit(ce, pe, 1) }}
  {{ device_edit(pe, ce, 2) }}
